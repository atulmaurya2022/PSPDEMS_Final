@model EMS.WebApp.Data.MedExaminationResultViewModel

@{
    ViewData["Title"] = "View Medical Examination Result";
}

<div id="alertContainer"></div>

<div class="row mb-3">
    <div class="col-md-12">
        <h4>View Medical Examination Result</h4>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "MedExaminationResult")">Medical Examination Results</a></li>
                <li class="breadcrumb-item active" aria-current="page">View</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Medical Examination Result Details</h5>
            </div>
            <div class="card-body">
                <!-- Employee Information -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <h6 class="text-primary border-bottom pb-2">Employee Information</h6>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Employee ID:</label>
                        <p>@Model.EmployeeId</p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Employee Name:</label>
                        <p>@Model.EmployeeName</p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Department:</label>
                        <p>@Model.Department</p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Designation:</label>
                        <p>@Model.Designation</p>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Date of Birth:</label>
                        <p>@Model.DOB</p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Age:</label>
                        <p>@Model.Age years</p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Gender:</label>
                        <p>@Model.Gender</p>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label fw-bold">Blood Group:</label>
                        <p>@Model.BloodGroup</p>
                    </div>
                </div>

                <!-- Examination Details -->
                <div class="row mb-4">
                    <div class="col-md-12">
                        <h6 class="text-primary border-bottom pb-2">Examination Details</h6>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Medical Examination Category:</label>
                        <p>@Model.CategoryName</p>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Last Check Up Date:</label>
                        <p>@(Model.LastCheckupDate?.ToString("dd-MMM-yyyy") ?? "N/A")</p>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Test Date:</label>
                        <p>@(Model.TestDate?.ToString("dd-MMM-yyyy") ?? "N/A")</p>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Test Location:</label>
                        <p>@Model.TestLocationName</p>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Result:</label>
                        <p>
                            @if (Model.Result == "Yes")
                            {
                                <span class="badge bg-success">@Model.Result</span>
                            }
                            else if (Model.Result == "No")
                            {
                                <span class="badge bg-danger">@Model.Result</span>
                            }
                            else
                            {
                                <span>@(Model.Result ?? "N/A")</span>
                            }
                        </p>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold">Plant:</label>
                        <p>@Model.PlantName</p>
                    </div>
                </div>

                <div class="row mb-4">
                    <div class="col-md-12">
                        <label class="form-label fw-bold">Remarks:</label>
                        <p class="border p-2 rounded bg-light">@(Model.Remarks ?? "No remarks")</p>
                    </div>
                </div>

                <!-- Approval Information -->
                @if (Model.ApprovalStatus != null)
                {
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <h6 class="text-primary border-bottom pb-2">Approval Information</h6>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Approval Status:</label>
                            <p>
                                @switch (Model.ApprovalStatus)
                                {
                                    case "Approved":
                                        <span class="badge bg-success">Approved</span>
                                        break;
                                    case "Rejected":
                                        <span class="badge bg-danger">Rejected</span>
                                        break;
                                    case "Pending":
                                        <span class="badge bg-warning text-dark">Pending</span>
                                        break;
                                    default:
                                        <span class="badge bg-secondary">@Model.ApprovalStatus</span>
                                        break;
                                }
                            </p>
                        </div>
                        @if (Model.ApprovedBy != null)
                        {
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Approved/Rejected By:</label>
                                <p>@Model.ApprovedBy</p>
                            </div>
                        }
                        @if (Model.ApprovedOn != null)
                        {
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Approved/Rejected On:</label>
                                <p>@Model.ApprovedOn?.ToString("dd-MMM-yyyy HH:mm")</p>
                            </div>
                        }
                    </div>

                    @if (!string.IsNullOrEmpty(Model.RejectionReason))
                    {
                        <div class="row mb-4">
                            <div class="col-md-12">
                                <label class="form-label fw-bold">Rejection Reason:</label>
                                <p class="border p-2 rounded bg-light text-danger">@Model.RejectionReason</p>
                            </div>
                        </div>
                    }
                }

                <!-- Action Buttons -->
                <div class="row mt-4">
                    <div class="col-md-12">
                        <a href="@Url.Action("Index", "MedExaminationResult")" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to List
                        </a>
                        @if (Model.CanEdit && Model.ApprovalStatus != "Approved")
                        {
                            <a href="@Url.Action("Edit", "MedExaminationResult", new { id = Model.ResultId })" class="btn btn-warning">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                        }
                        @if (Model.CanDelete && Model.ApprovalStatus != "Approved")
                        {
                            <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this medical examination result?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#confirmDeleteBtn').on('click', function () {
                $.ajax({
                    url: '@Url.Action("Delete", "MedExaminationResult")',
                    type: 'POST',
                    data: {
                        resultId: @Model.ResultId,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function (response) {
                        if (response.success) {
                            window.location.href = '@Url.Action("Index", "MedExaminationResult")';
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function () {
                        alert('Error deleting result. Please try again.');
                    }
                });
            });
        });
    </script>
}

<style>
    .card {
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .card-header {
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
    }

    .form-label.fw-bold {
        color: #495057;
        margin-bottom: 0.25rem;
    }

    p {
        margin-bottom: 0;
        color: #212529;
    }

    .border-bottom {
        border-bottom: 2px solid #dee2e6 !important;
    }
</style>

@Html.AntiForgeryToken()
