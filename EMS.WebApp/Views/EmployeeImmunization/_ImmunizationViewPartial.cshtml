@model EMS.WebApp.Data.ImmunizationViewModel

<style>
    .glass {
        --glass-bg: rgba(255, 255, 255, 0.30) !important;
    }

    .view-label {
        font-weight: 600;
        color: #495057;
        margin-bottom: 0.25rem;
    }

    .view-value {
        color: #212529;
        padding: 0.5rem 0;
        border-bottom: 1px solid #e9ecef;
    }

    .dose-badge {
        font-size: 0.875rem;
        padding: 0.375rem 0.75rem;
        border-radius: 0.375rem;
        font-weight: 500;
    }
</style>

<!-- Employee Details Section -->
<div id="employeeDetailsSection" class="mb-3">
    @for (int i = 0; i < Model.EmployeeDetails.Count; i++)
    {
        <div class="border p-3 mb-3 rounded glass">
            <h6 class="text-primary mb-3">Employee Details</h6>
            <div class="row">
                <div class="col-md-3">
                    <div class="view-label">Employee ID:</div>
                    <div class="view-value">@Model.EmployeeDetails[i].emp_id</div>
                </div>
                <div class="col-md-3">
                    <div class="view-label">Name:</div>
                    <div class="view-value">@Model.EmployeeDetails[i].emp_name</div>
                </div>
                <div class="col-md-3">
                    <div class="view-label">Department:</div>
                    <div class="view-value">@(Model.EmployeeDetails[i].org_department?.dept_name ?? "")</div>
                </div>
                <div class="col-md-3">
                    <div class="view-label">Grade:</div>
                    <div class="view-value">@Model.EmployeeDetails[i].emp_Grade</div>
                </div>
            </div>
        </div>
    }
</div>

<!-- Immunization Records Section -->
<div id="immunizationRecordsSection" class="mb-3">
    @if (Model.ExistingRecords.Any())
    {
        foreach (var record in Model.ExistingRecords)
        {
            <div class="border p-3 mb-3 rounded glass">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="text-primary mb-0">@(record.RefImmunizationType?.immun_type_name ?? "Immunization Record")</h6>
                    @{
                        var isComplete = record.dose_1_date.HasValue &&
                        record.dose_2_date.HasValue &&
                        record.dose_3_date.HasValue &&
                        record.dose_4_date.HasValue &&
                        record.dose_5_date.HasValue &&
                        record.booster_dose_date.HasValue;
                    }
                    @if (isComplete)
                    {
                        <span class="badge bg-success">All Doses Complete</span>
                    }
                    else
                    {
                        <span class="badge bg-warning">In Progress</span>
                    }
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="view-label">Patient Name:</div>
                        <div class="view-value">@record.patient_name</div>
                    </div>
                    <div class="col-md-6">
                        <div class="view-label">Relationship:</div>
                        <div class="view-value">@record.relationship</div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <h6 class="mb-3">Immunization Doses</h6>
                    </div>
                    <div class="col-md-2">
                        <div class="view-label">1st Dose</div>
                        <div class="view-value">
                            @if (record.dose_1_date.HasValue)
                            {
                                <span>@record.dose_1_date.Value.ToString("dd/MM/yyyy")</span>
                                <span class="badge bg-success ms-2">Done</span>
                            }
                            else
                            {
                                <span class="text-muted">Not Given</span>
                            }
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="view-label">2nd Dose</div>
                        <div class="view-value">
                            @if (record.dose_2_date.HasValue)
                            {
                                <span>@record.dose_2_date.Value.ToString("dd/MM/yyyy")</span>
                                <span class="badge bg-success ms-2">Done</span>
                            }
                            else
                            {
                                <span class="text-muted">Not Given</span>
                            }
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="view-label">3rd Dose</div>
                        <div class="view-value">
                            @if (record.dose_3_date.HasValue)
                            {
                                <span>@record.dose_3_date.Value.ToString("dd/MM/yyyy")</span>
                                <span class="badge bg-success ms-2">Done</span>
                            }
                            else
                            {
                                <span class="text-muted">Not Given</span>
                            }
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="view-label">4th Dose</div>
                        <div class="view-value">
                            @if (record.dose_4_date.HasValue)
                            {
                                <span>@record.dose_4_date.Value.ToString("dd/MM/yyyy")</span>
                                <span class="badge bg-success ms-2">Done</span>
                            }
                            else
                            {
                                <span class="text-muted">Not Given</span>
                            }
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="view-label">5th Dose</div>
                        <div class="view-value">
                            @if (record.dose_5_date.HasValue)
                            {
                                <span>@record.dose_5_date.Value.ToString("dd/MM/yyyy")</span>
                                <span class="badge bg-success ms-2">Done</span>
                            }
                            else
                            {
                                <span class="text-muted">Not Given</span>
                            }
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="view-label">Booster Dose</div>
                        <div class="view-value">
                            @if (record.booster_dose_date.HasValue)
                            {
                                <span>@record.booster_dose_date.Value.ToString("dd/MM/yyyy")</span>
                                <span class="badge bg-success ms-2">Done</span>
                            }
                            else
                            {
                                <span class="text-muted">Not Given</span>
                            }
                        </div>
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(record.remarks))
                {
                    <div class="row">
                        <div class="col-12">
                            <div class="view-label">Remarks:</div>
                            <div class="view-value">@record.remarks</div>
                        </div>
                    </div>
                }

                @* <div class="row mt-3">
                    <div class="col-12">
                        <small class="text-muted">
                            Created by: @record.created_by on @record.created_date.ToString("dd/MM/yyyy HH:mm")
                        </small>
                    </div>
                </div> *@
            </div>
        }
    }
    else
    {
        <div class="border p-3 mb-3 rounded glass">
            <p class="text-muted text-center py-3">No immunization records found</p>
        </div>
    }
</div>

<!-- Close Button -->
<div class="row">
    <div class="col-12">
        <button type="button" class="btn btn-secondary" id="closeViewBtn">Close</button>
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#closeViewBtn').on('click', function() {
            // Clear the container and go back
            $('#immunizationFormContainer').html('');
            $('#allRecordsTableContainer').show();
            $('#backToAllRecordsBtn').hide();
        });
    });
</script>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}